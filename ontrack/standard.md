###又是标准###
不要总是觉得标准是个限制程序员自由发挥的坏东西。C 语言多年来进行了多次标准更新，虽然不一定会像 Java 的更新一样引起人们广泛的注意，但是如果细看一些新标准的内容，我们会发现新的 C 语言也具备一些方便的特性。
####C99####
顾名思义，这个标准是在 99 年左右颁布的，然而不要看它已经距今十多年了，很多教材仍然没有提到这个标准，甚至可能作者自己都不知道，呵呵。在 C99 之前有一个 C89 的标准，有人也称它为 _ANSI C_ ，可以说是 C 语言的第一个标准。而在 C89 出现之前呢，“标准”的 C 语言写法被称为 _K&R_ ，这个名字的来由是著名的 C 语言著作《C 程序设计语言》 (_The C Programming Language_) 的作者 Brain Kernighan 和 Dennis Ritchie（2011年去世）姓首字母的缩写。虽然那本书成书的时候 C 语言的标准还没定型，主函数还没有返回类型直接写成``main() { }``的形式，但是书里使用的编码技巧和风格，拿到几十年后的今天，依然令有些人汗颜。

下面说一下 C99 标准里一些相对重要的新特性：

* 数组长度可以是不固定的，比如可以用变量来定义数组：``int array[n];`` ，同时在结构里也可以声明一个不明确长度的数组
* 支持 C++ 风格的单行注释，即``// ...``
* 引入了``long long int``类型
* 引入了``bool``类型（需包含``stdbool.h``）
* 引入了``complex``类型（需包含``complex.h``）
* 在``inttypes.h``中定义了``int8_t``、``int16_t``、``int32_t``、``int64_t``和它们对应的``unsigned``类型
* 变量不一定要在代码块的开头全部定义
* 引入``snprintf``等新函数
* 支持可变参数的宏
* 在``math.h``中引入了``isnan``和``isinf``等函数

说一下最后那个。试着编译一段这样的代码：

	double a = 1.0 / 0.0;
	double b = a / a;
	printf("%.5lf %.5lf %d %d\n", a, b, isinf(a), isnan(b));

如果你的编译器支持 C99，结果可能会是这样：

	inf nan 1 1

有没有觉得很神奇？要是试试用整数的 1 去除以整数的 0 的话，编译器直接就给警告了，说结果是 undefined.

什么是 inf 呢？就是无穷大。比如你拿一个正数去除以 0.0（负数的话结果是 -inf），或者用一个常数去加 inf，结果都是 inf. 而 nan的意思是 _Not A Number_ ，如果给负数开方，或者用 inf 除 inf，结果都会是 nan.

怎么做到的……？别急，先想一想上课时候老师讲过的计算机里浮点数的表示方法。**浮点数** (Floating Numbers) 分为三个部分，符号位，指数位，小数位。根据浮点数的标准 _IEEE 754_ 的规定，指数位和小数位全 0 或全 1 的状态代表这样一些特殊情况：

* 指数位全 0 且小数位全 0，这个数为 0
* 指数位全 0 小数位非全 0，错误
* 指数位全 1 且小数位全 0，根据符号位来确定是 +inf 还是 -inf
* 指数位全 1 小数位非全 0，nan

如果你的观察力够好，那么会发现一个数为 nan 的情况其实有很多种，只要小数部分不是都是 0 就行了。那么我们完全可以在一个 nan 的小数部分里面写入信息，比如规定 nan 的小数部分如果为 10000001 那就表示是负数开方导致的，10000010 表示是除 inf 导致的，等等。这种技巧称为 nan 的包装。

话说回来，说了这么多东西，那 C99 要如何使用呢？如果你使用的是 gcc 或 mingw （Dev-C++ 和 Code::Blocks 默认编译器），那么编译选项里加上 -std=c99 就可以了。clang 是默认支持 c99 的。微软嘛……微软系对 C/C++ 标准一直不太上心。最新的 Visual Studio 版本不知道，不过 Visual Studio 2008 貌似是不支持的。